<!DOCTYPE html>
<html>

  <head>
    <base target="_top">
  </head>

  <body>

    <!--style for header bar-->
    <div class="header">
      <h1 class="heading">QueueConnect</h1>
      <h1 class="heading page_title">Welcome</h1>
    </div>

    <!--role selection page-->
    <div class="role_select" id="role_select">
      <p class="select_role_text">Please select a role:</p>
      <div class="tooltip">
        <button class="role_select_button" onclick="revealStudent()" id="student_button">Student</button>
        <span class="tooltiptext">Click to join a queue of your choice</span>
      </div>
      <div class="tooltip">
        <button class="role_select_button" onclick="call_reveal_queue_select_page()" id="teacher_button">Teacher</button>
        <span class="tooltiptext">Click to create and edit queues</span>
      </div>
    </div>

    <!--student queue selection page-->
    <div class="inputs" id="student_page">
      <div class="tooltipstudent">
        <label id="chse_queue">Name: </label><input class="join_queue_details" type="text" placeholder="Enter name..." id="username">
        <span class="tooltiptextstud">Enter the name that you want your teacher to see</span>
      </div>
      <br>
      <div class="tooltipstudent">
        <label id="chse_queue">Queue: </label><input class="join_queue_details" type="text" placeholder="Enter queue..." id="choose_queue">
        <span class="tooltiptextstud">Enter the queue name given by your teacher</span>
      </div>
    </div>

    <!-- student name submit button -->
    <div class="submit" id="submit">
    <button class="submit_button" onclick="position_page()" id="submit_btn">Submit</button>
    </div>

    <!-- Refresh button and position in queue display -->
    <div class="status" id="status">
      <p id="place" class="place">Your position in the queue is:</p>
      <p id="position" class="position"></p>
      <p id="refresh" class="refresh">Please do not refresh website</p>
      <button class="refresh_button" onclick="button_refresh()" id="refresh_btn" title="Updates your position if changes have occured">Refresh Queue</button>
    </div>
    
    <!--teacher queue create/select page-->
    <div class="queue_select_page" id="queue_select_page">
      <button class="create_queue_button" onclick="reveal_create_queue()" id="create_queue_button" title="Create a new queue with a custom name and password">Create a new queue</button>
      <p class="queue_create_tip">Click on the below buttons to view your queues:</p>
    </div>

    <!--teacher queue creation page-->
    <div class="queue_create_menu" id="queue_create_menu">
      <button class="queue_back_button" onclick="call_reveal_queue_select_page(); back()" title="Go back to queue page">Back</button>
      <br>
      <label class="queue_label">Queue name: </label><input class="queue_inputs" type="text" placeholder="Enter name of new queue..." id="queue_name">
      <p class="create_queue_tip">Type the name that you will use to select this queue</p>
      <br>
      <label class="queue_label">Password: </label><input class="queue_inputs" type="text" placeholder="Enter password for new queue..." id="queue_password">
      <p class="create_queue_tip">Type the password that students will use to join this queue</p>
      <br>
      <button class="queue_submit" onclick="submit_queue()" id="queue_submit">Create Queue</button>
    </div>

    <!-- queue display page -->
    <div class="queue_display" id="queue_display">
      <p id="queue_title">Students:</p>
      <button class="queue_back_button" onclick="call_reveal_queue_select_page(); back()" title="Go back to queue page">Back</button>
    </div>

    <style>
      .username {
        margin-bottom: 10px;
      }

      .create_queue_tip {
        font-size: 15px;
        color: gray;
        text-align: center;
      }

      .queue_inputs {
        display: block;
        margin: auto;
      }

      .queue_inputs::placeholder {
        font-size: 20px;
      }

      .queue_create_tip {
        color: gray;
        text-align: center;
        margin-bottom: 20px;
        width: 40%;
        margin-left: auto;
        margin-right: auto;
      }

      .join_queue_details {
        margin-left: -10px;
      }

      .chse_queue {
        display: inline-block;
      }

      .queue_label {
        margin-top: 30px;
        display: inline-block;
        margin-left: 495px;
      }

      .queue_submit {
        padding: 10px 25px 10px 25px;
        background-color: white;
        border-radius: 200px;
        font-size: 35px;
        border-color: gray;
        transition-duration: 0.4s;
        margin-left: 510px;
        margin-right: 500px;
      }

      .queue_submit:hover {
        background-color: gray;
        color: white;
      }

      .create_queue_button {
        padding: 10px 25px 10px 25px;
        background-color: light-gray;
        border-radius: 15px;
        font-size: 15px;
        border-color: gray;
        transition-duration: 0.2s;
        margin-left: 530px;
        margin-right: 500px;
        display: inline-block;
        margin-bottom: 10px;
        width: 20%;
        margin-top: 20px;
      }

      .create_queue_button:hover {
        background-color: white;
        color: black;
      }

      .role_select {
        text-align: center;
        margin-top: 175px;
        font-size: 30px;
        margin-left: auto;
        margin-right: auto;
      }

      .role_select_button {
        padding: 10px 25px 10px 25px;
        background-color: white;
        border-radius: 5px;
        font-size: 35px;
        border-color: gray;
        transition-duration: 0.4s;
        position: inline-block;
      }

      .role_select_button:hover {
        background-color: gray;
        color: white;
      }

      .header {
        background-color: rgb(75, 125, 35);
        color: white;
      }

      .heading {
        display: inline-block;
        padding-left: 20px;
      }

      .page_title {
        margin-left: 350px;
      }

      .submit {
        text-align: center;
        margin-top: 50px;
        display: none;
      }

      .submit_button {
        padding: 10px 25px 10px 25px;
        background-color: white;
        border-radius: 200px;
        font-size: 35px;
        border-color: gray;
        transition-duration: 0.4s;
      }

      body {
        background-color: rgb(225, 234, 224);
      }

      .inputs {
        text-align: center;
        margin-top: 175px;
        display: none;
        margin-left: 500px;
      }

      input {
        height: 30px;
        width: 300px;
        font-size: 30px;
      }

      label {
        font-size: 30px;
      }

      select {
        height: 35px;
        width: 300px;
        font-size: 30px;
        margin-top: 25px;
      }

      .pick {
        color: gray;
      }

      .submit_button:hover {
        background-color: gray;
        color: white;
      }

      .position {
        font-size: 50px;
      }

      .refresh_button {
        margin: auto;
      }

      .status {
        display: none;
        margin: auto;
      }

      .queue_create_menu {
        display: none;
      }

      .queue_select_page {
        display: none;
      }

      .queue_display {
        display: none;
      }

      .queue_back_button {
        position: absolute;
        top: 100px;
        left: 5px;
      }

      .queue_button {
        padding: 10px 30px 10px 30px;
        background-color: white;
        border-radius: 5px;
        font-size: 15px;
        border-color: gray;
        transition-duration: 0.2s;
        margin-left: 500px;
        margin-right: 500px;
        margin-bottom: 10px;
        width: 25%;
      }

      .queue_button:hover {
        background-color: gray;
        color: white;
      }

      .name_manage_button {
        margin-top: 10px;
        border-width: 2px;
        padding-bottom: 3px;
      }

      .name_manage_button:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);

      }

      .queue_name {
        margin-bottom: 0px;
        font-size: 45px;
      }

      .queue {
        display: block;
        font-size: 30px;
        max-width: fit-content;
        margin-left: auto;
        margin-right: auto;
        margin-top: 30px;
        margin-bottom: 50px;
        background-color: #5e8b52;
        padding-left: 60px;
        padding-right: 70px;
        padding-top: 10px;
        padding-bottom: 25px;
        border-radius: 20px;
      }

      .remove_button {
        display: inline-block;
        border-top-left-radius: 10px;
        border-bottom-left-radius: 10px;
        border-width: 2px;
        background-color: #fcc5c8;
      }

      .down_button {
        display: inline-block;
        border-top-right-radius: 10px;
        border-bottom-right-radius: 10px;
        border-width: 2px;
      }

      /* Tooltip container */
      .tooltip {
        position: relative;
        width: 130px;
        display: inline-block;
        margin-left: 25px;
        margin-right: 50px;
      }

      /* Tooltip text */
      .tooltip .tooltiptext {
        visibility: hidden;
        width: 130px;
        background-color: black;
        color: #fff;
        text-align: center;
        padding: 5px 0;
        border-radius: 6px;
        font-size: 15px;
      
        /* Position the tooltip text */
        position: absolute;
        z-index: 1;
        bottom: 100%;
        left: 50%;
        margin-left: -35px;
        margin-bottom: 5px;
      }

      /* Show the tooltip text when you mouse over the tooltip container */
      .tooltip:hover .tooltiptext {
        visibility: visible;
      }

      .tooltip .tooltiptext::after {
        content: " ";
        position: absolute;
        top: 100%; /* At the bottom of the tooltip */
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: black transparent transparent transparent;
      }



      /* Tooltip container */
      .tooltipstudent {
        position: relative;
        width: 130px;
      }

      /* Tooltip text */
      .tooltipstudent .tooltiptextstud {

        visibility: hidden;
        width: 130px;
        background-color: black;
        color: #fff;
        text-align: center;
        padding: 5px 0;
        border-radius: 6px;
        font-size: 15px;
      
        /* Position the tooltip text */
        position: absolute;
        z-index: 1;
        bottom: 100%;
        left: 50%;
      }

      /* Show the tooltip text when you mouse over the tooltip container */
      .tooltipstudent:hover .tooltiptextstud {
        visibility: visible;
      }

      .tooltipstudent .tooltiptextstud::after {
        content: " ";
        position: absolute;
        top: 100%; /* At the bottom of the tooltip */
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: black transparent transparent transparent;
      }

    </style>


    <script>

      //global variables
      var lists = []; //an array that is filled with the names of all queues
      var queue_names = "unchanged"
      var current_queue = ""

      document.getElementById("submit_btn").addEventListener("click", doStuff); //adds doStuff function to the submit button

      function onSuccess(position) {
        document.getElementById("position").textContent = position;
      }

      function doStuff(){
        var usrname = document.getElementById("username").value;
        var queue_select = document.getElementById("choose_queue").value;
        google.script.run.submit(usrname, queue_select);
        google.script.run.withSuccessHandler(onSuccess) //links to Code.gs
          .countSpacesAboveWord(usrname, queue_select);
      }

    function revealStudent(){ //shows the page for a student to join a queue
      var rl_slect = document.getElementById("role_select");
      rl_slect.style.display = "none";
      var student_page = document.getElementById("student_page")
      student_page.style.display = "block";
      var submit = document.getElementById("submit")
      submit.style.display = "block"
    }

    function button_refresh(){ //refreshes the student page so they can see changes in their position
      var usrname = document.getElementById("username").value;
        var queue_select = document.getElementById("choose_queue").value;
      google.script.run.withSuccessHandler(onSuccess)
          .countSpacesAboveWord(usrname, queue_select);
    }

    function hide_all(){ //hides all divs except for header bar
      var role_select = document.getElementById("role_select");
      role_select.style.display = "none";
      var student_page = document.getElementById("student_page");
      student_page.style.display = "none";
      var submit = document.getElementById("submit");
      submit.style.display = "none";
      var status = document.getElementById("status");
      status.style.display = "none";
      var queue_create_menu = document.getElementById("queue_create_menu");
      queue_create_menu.style.display = "none";
      var queue_select_page = document.getElementById("queue_select_page");
      queue_select_page.style.display = "none";
      var queue_display = document.getElementById("queue_display");
      queue_display.style.display = "none";
    }

    function position_page(){ //shows the student position page
      hide_all()
      var status = document.getElementById("status");
      status.style.display = "block";
    }

    function back() { //goes back from queue create page
      var queue_page = document.getElementById("queue_display")
      while (queue_page.childElementCount > 2) {
        queue_page.removeChild(queue_page.lastChild);
      }
    }

    function call_reveal_queue_select_page(){ //requests the sheet names for the queue select page
      google.script.run.withSuccessHandler(reveal_queue_select_page).getSheetNames();
    }

    function get_queue_contents(queue_name) { //requests the contents of a selected queue
      google.script.run.withSuccessHandler(function(names) {
        display_queue_button_part_2(names)
      }).get_queue_contents_GS(queue_name);
    }

    function reveal_queue_select_page(names){ //names is an array containing the name of each spreadsheet
      
      hide_all()
      var queue_select_page = document.getElementById("queue_select_page")
      queue_select_page.style.display = "block";

      counter = 0

      for (name in names) {
        if (!(lists.includes(names[name][0]))) { //runs if lists does not include the iteration of names
          counter = counter + 1
          var btn = document.createElement("button");
          btn.setAttribute("name", names[name][0]); //sets the name attribute of the button to names[name]
          var node = document.createTextNode(names[name]); //adds the iteration of names as the label to the button

          btn.addEventListener("click", function () { //adds functionality to the queue buttons
            hide_all()
            queue_title.textContent = this.getAttribute("name"); //uses the name attribute of the button to create title
            queue_title.style.fontWeight = "bold";
            queue_title.style.color = "white";
            current_queue = this.getAttribute("name");
            get_queue_contents(this.getAttribute("name")); //passes the name attribute into get_queue_contents
            var queue_display = document.getElementById("queue_display")
            queue_display.style.display = "block";
          })

          //CSS for queue buttons
          btn.classList.add("queue_button");
          btn.title = "View the selected queue"


          btn.appendChild(node);
          var element = document.getElementById("queue_select_page");
          element.appendChild(btn);
          lists.push(names[name][0]);
          var br = document.createElement("br");
          element.appendChild(br);
        }
      }
    }

    function display_queue_button_part_2(queue_names) { //displays the contents of the queue
      var queue_display = document.getElementById("queue_display")

      //CSS for the queue contents
      queue_display.classList.add("queue");

      for (i in queue_names) { //adds the names to the queue
        var queue_page = document.createElement("p");
        var queue_node = document.createTextNode(queue_names[i]);
        queue_page.appendChild(queue_node);
        var element = document.getElementById("queue_display"); 
        element.appendChild(queue_page);

        //adds CSS to the queue names
        queue_page.classList.add("queue_name");

        var remove_button = document.createElement("button");
        remove_button.setAttribute("name", queue_names[i]); //sets the name attribute of the button to the name it is next to
        var node = document.createTextNode("X"); 
       
       //adds functionality to the remove button
        remove_button.addEventListener("click", function () {
          remove_name = this.getAttribute("name")
          google.script.run.withSuccessHandler(function(current_queue) {
            var queue_page = document.getElementById("queue_display")
            while (queue_page.childElementCount > 2) { //removes all of the names
              queue_page.removeChild(queue_page.lastChild);
            }
            get_queue_contents(current_queue) //adds all of the names back from the updated list
          }).remove_name_from_queue(remove_name, current_queue);
        })

        //appends the remove button
        remove_button.appendChild(node);
        var element = document.getElementById("queue_display");
        element.appendChild(remove_button);

        //CSS for the remove button
        remove_button.classList.add("remove_button")
        remove_button.classList.add("name_manage_button");
        remove_button.title = "Remove this student"

        //appends the up button
        var up_button = document.createElement("button");
        up_button.setAttribute("name", queue_names[i]); //sets the name attribute of the button to the name it is next to
        var node = document.createTextNode("↑"); 
        up_button.appendChild(node);
        var element = document.getElementById("queue_display");
        element.appendChild(up_button);

        //CSS for the up button
        up_button.classList.add("name_manage_button");
        up_button.title = "Move this student up one position"

        //adds functionality to the up button
        up_button.addEventListener("click", function () {
          move_name = this.getAttribute("name")
          google.script.run.withSuccessHandler(function(current_queue) {
            var queue_page = document.getElementById("queue_display")
            while (queue_page.childElementCount > 2) { //removes all of the names
              queue_page.removeChild(queue_page.lastChild);
            }
            get_queue_contents(current_queue) //adds all of the names back from the updated list
          }).move_name_up(move_name, current_queue);
        })

        //appends the down button
        var down_button = document.createElement("button");
        down_button.setAttribute("name", queue_names[i]); //sets the name attribute of the button to the name it is next to
        var node = document.createTextNode("↓"); 
        down_button.appendChild(node);
        var element = document.getElementById("queue_display");
        element.appendChild(down_button);

        //CSS for the down button
        down_button.classList.add("name_manage_button");
        down_button.classList.add("down_button")
        down_button.title = "Move this student down one position"

        //adds functionality to the down button
        down_button.addEventListener("click", function () {
          move_name = this.getAttribute("name")
          google.script.run.withSuccessHandler(function(current_queue) {
            var queue_page = document.getElementById("queue_display")
            while (queue_page.childElementCount > 2) { //removes all of the names
              queue_page.removeChild(queue_page.lastChild);
            }
            get_queue_contents(current_queue) //adds all of the names back from the updated list
          }).move_name_down(move_name, current_queue);
        })
      }
    }

    function reveal_create_queue(){ //shows the queue create menu
      hide_all()
      var queue_create_menu = document.getElementById("queue_create_menu");
      queue_create_menu.style.display = "block";

    }

    function submit_queue(){ //creates a new queue
      var queue_name = document.getElementById("queue_name").value;
      var queue_password = document.getElementById("queue_password").value;
      google.script.run.newQueue(queue_name, queue_password);
      hide_all()
      document.getElementById("queue_name").value = "";
      document.getElementById("queue_password").value = "";
      call_reveal_queue_select_page()
    }

    function refresh(queue_name){ //refreshes a queue to show changes
      var queue_page = document.getElementById("queue_display")
      while (queue_page.childElementCount > 2) {
        queue_page.removeChild(queue_page.lastChild);
      }
      get_queue_contents(queue_name)
    }

    </script>

  </body>

</html>
