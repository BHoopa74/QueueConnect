<!DOCTYPE html>
<html>

  <head>
    <base target="_top">
  </head>

  <body>

    <!--style for header bar-->
    <div class="header">
      <h1 class="heading">QueueConnect</h1>
      <h1 class="heading page_title">Welcome</h1>
    </div>

    <!--role selection page-->
    <div class="role_select" id="role_select">
      <p class="select_role_text">Please select a role:</p>
      <button class="role_select_button" onclick="revealStudent()" id="student_button">Student</button>
      <button class="role_select_button" onclick="call_reveal_queue_select_page()" id="teacher_button">Teacher</button>
    </div>

    <!--student queue selection page-->
    <div class="inputs" id="student_page">
      <label id="label2">Name: </label><input class="username" type="text" placeholder="Enter name..." id="username">
      <br>
      <label id="chse_queue">Queue: </label><input type="text" placeholder="Enter queue..." id="choose_queue">
    </div>

    <!-- student name submut button -->
    <div class="submit" id="submit">
    <button class="submit_button" onclick="hideAllStudent()" id="submit_btn">Submit</button>
    </div>

    <!-- Refresh button and position in queue display -->
    <div class="status" id="status">
      <p id="place" class="place">Your position in the queue is:</p>
      <p id="position" class="position"></p>
      <p id="refresh" class="refresh">Please do not refresh page</p>
      <button class="refresh_button" onclick="button_refresh()" id="refresh_btn">Refresh Queue</button>
    </div>
    
    <!--teacher queue create/select page-->
    <div class="queue_select_page" id="queue_select_page">
      <button class="create_queue_button" onclick="reveal_create_queue()" id="create_queue_button">Create a new queue</button>
    </div>

    <!--teacher queue creation page-->
    <div class="queue_create_menu" id="queue_create_menu">
      <br>
      <label class="queue_label">Queue name: </label><input class="queue_inputs" type="text" placeholder="Enter name..." id="queue_name">
      <br>
      <label class="queue_label">Password: </label><input class="queue_inputs" type="text" placeholder="Enter password..." id="queue_password">
      <br>
      <button class="queue_submit" onclick="submit_queue()" id="queue_submit">Create Queue</button>
    </div>

    <!-- queue display page -->
    <div class="queue_display" id="queue_display">
      <br>
      <br>
      <p id="queue_title">Students:</p>
      <button class="queue_back_button" onclick="call_reveal_queue_select_page(); back()">Back</button>
    </div>


    <style>
      .username {
        margin-bottom: 10px;
      }

      .queue_inputs {
        display: block;
        margin: auto;
      }

      .queue_label {
        margin-top: 30px
        display: inline-block;
        margin-left: 495px;
      }

      .queue_submit {
        padding: 10px 25px 10px 25px;
        background-color: white;
        border-radius: 200px;
        font-size: 35px;
        border-color: gray;
        transition-duration: 0.4s;
        margin-left: 510px;
        margin-right: 500px;
      }

      .queue_submit:hover {
        background-color: gray;
        color: white;
      }

      .create_queue_button {
        padding: 10px 25px 10px 25px;
        background-color: light-gray;
        border-radius: 15px;
        font-size: 15px;
        border-color: gray;
        transition-duration: 0.2s;
        margin-left: 530px;
        margin-right: 500px;
        margin-bottom: 15px;
        width: 20%;
        margin-top: 20px;
      }

      .create_queue_button:hover {
        background-color: white;
        color: black;
      }

      .role_select {
        text-align: center;
        margin-top: 175px;
        font-size: 30px;
      }

      .role_select_button {
        padding: 10px 25px 10px 25px;
        background-color: white;
        border-radius: 5px;
        font-size: 35px;
        border-color: gray;
        transition-duration: 0.4s;
      }

      .role_select_button:hover {
        background-color: gray;
        color: white;
      }

      .header {
        background-color: rgb(75, 125, 35);
        color: white;
      }

      .heading {
        display: inline-block;
        padding-left: 20px;
      }

      .page_title {
        margin-left: 350px;
      }

      .submit {
        text-align: center;
        margin-top: 50px;
        display: none;
      }

      .submit_button {
        padding: 10px 25px 10px 25px;
        background-color: white;
        border-radius: 200px;
        font-size: 35px;
        border-color: gray;
        transition-duration: 0.4s;
      }

      body {
        background-color: rgb(225, 234, 224);
      }

      .inputs {
        text-align: center;
        margin-top: 175px;
        display: none;
      }

      input {
        height: 30px;
        width: 300px;
        font-size: 30px;
      }

      label {
        font-size: 30px;
      }

      select {
        height: 35px;
        width: 300px;
        font-size: 30px;
        margin-top: 25px;
      }

      .pick {
        color: gray;
      }

      .submit_button:hover {
        background-color: gray;
        color: white;
      }

      .position {
        font-size: 50px;
      }

      .refresh_button {
        margin: auto;
      }

      .status {
        display: none;
      }

      .queue_create_menu {
        display: none;
      }

      .queue_select_page {
        display: none;
      }

      .queue_display {
        display: none;
      }

      .queue_back_button {
        position: absolute;
        top: 100px;
        left: 5px;
      }

      .queue_button {
        padding: 10px 30px 10px 30px;
        background-color: white;
        border-radius: 5px;
        font-size: 15px;
        border-color: gray;
        transition-duration: 0.2s;
        margin-left: 500px;
        margin-right: 500px;
        margin-bottom: 10px;
        width: 25%;
      }

      .queue_button:hover {
        background-color: gray;
        color: white;
      }

    </style>

    <script>
      
      var lists = []; //an array that is filled with the names of all queues
      var queue_names = "unchanged"

      document.getElementById("submit_btn").addEventListener("click", doStuff); //adds doStuff function to the submit button

      function onSuccess(position) {
        console.log(position);
        document.getElementById("position").textContent = position;
      }

      function doStuff(){
        var usrname = document.getElementById("username").value;
        var queue_select = document.getElementById("choose_queue").value;
        google.script.run.submit(usrname, queue_select);
        google.script.run.withSuccessHandler(onSuccess) //links to Code.gs
          .countSpacesAboveWord(usrname, queue_select);
      }

    function revealStudent(){
      var rl_slect = document.getElementById("role_select");
      rl_slect.style.display = "none";
      var student_page = document.getElementById("student_page")
      student_page.style.display = "block";
      var submit = document.getElementById("submit")
      submit.style.display = "block"
    }

    function button_refresh(){
      var usrname = document.getElementById("username").value;
        var queue_select = document.getElementById("choose_queue").value;
      google.script.run.withSuccessHandler(onSuccess)
          .countSpacesAboveWord(usrname, queue_select);
    }

    function hide_all(){ //hides all divs except for header bar
      var role_select = document.getElementById("role_select");
      role_select.style.display = "none";
      var student_page = document.getElementById("student_page");
      student_page.style.display = "none";
      var submit = document.getElementById("submit");
      submit.style.display = "none";
      var status = document.getElementById("status");
      status.style.display = "none";
      var queue_create_menu = document.getElementById("queue_create_menu");
      queue_create_menu.style.display = "none";
      var queue_select_page = document.getElementById("queue_select_page");
      queue_select_page.style.display = "none";
      var queue_display = document.getElementById("queue_display");
      queue_display.style.display = "none";
    }

    function back() { //goes back from queue create page
      var queue_page = document.getElementById("queue_display")
      while (queue_page.childElementCount > 4) {
        queue_page.removeChild(queue_page.lastChild);
      }
    }

    function call_reveal_queue_select_page(){
      google.script.run.withSuccessHandler(reveal_queue_select_page).getSheetNames();
    }

    function get_queue_contents(queue_name) {
      google.script.run.withSuccessHandler(function(names) {
        display_queue_button_part_2(names)
      }).get_queue_contents_GS(queue_name);
    }

    function reveal_queue_select_page(names){ //names is an array containing the name of each spreadsheet
      
      hide_all()
      var queue_select_page = document.getElementById("queue_select_page")
      queue_select_page.style.display = "block";

      counter = 0

      for (name in names) {
        if (!(lists.includes(names[name][0]))) { //runs if lists does not include the iteration of names
          counter = counter + 1
          var btn = document.createElement("button");
          btn.setAttribute("name", names[name][0]); //sets the name attribute of the button to names[name]
          var node = document.createTextNode(names[name]); //adds the iteration of names as the label to the button

          btn.addEventListener("click", function () {
            hide_all()
            queue_title.textContent = this.getAttribute("name"); //uses the name attribute of the button to create title
            queue_title.style.fontWeight = "bold";
            get_queue_contents(this.getAttribute("name")); //passes the name attribute into get_queue_contents
            var queue_display = document.getElementById("queue_display")
            queue_display.style.display = "block";
          })

          btn.classList.add("queue_button");
          btn.appendChild(node);
          var element = document.getElementById("queue_select_page");
          element.appendChild(btn);
          lists.push(names[name][0]);
          var br = document.createElement("br");
          element.appendChild(br);
        }
      }
    }

    function display_queue_button_part_2(queue_names) {
      var queue_display = document.getElementById("queue_display")
      queue_display.style.display = "block";
      for (i in queue_names) {
        var queue_page = document.createElement("p");
        console.log(queue_names[i])
        var queue_node = document.createTextNode(queue_names[i]);
        queue_page.appendChild(queue_node);
        var element = document.getElementById("queue_display"); 
        element.appendChild(queue_page);
      }
    }

    function reveal_create_queue(){
      hide_all()
      var queue_create_menu = document.getElementById("queue_create_menu");
      queue_create_menu.style.display = "block";
    }

    function submit_queue(){
      var queue_name = document.getElementById("queue_name").value;
      var queue_password = document.getElementById("queue_password").value;
      google.script.run.newQueue(queue_name, queue_password);
      hide_all()
      document.getElementById("queue_name").value = "";
      document.getElementById("queue_password").value = "";
      call_reveal_queue_select_page()
    }

    </script>

  </body>

</html>
